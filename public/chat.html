<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>VERA - Your Nervous System Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
        }

        /* Theme Variables */
        :root {
            /* Light Theme (Default) */
            --bg-gradient: linear-gradient(180deg, #E8D5F2 0%, #D4C5F9 100%);
            --header-bg: rgba(255, 255, 255, 0.7);
            --container-bg: rgba(255, 255, 255, 0.95);
            --message-bg: #FFFFFF;
            --user-message-bg: linear-gradient(135deg, rgba(155, 137, 212, 0.15) 0%, rgba(123, 158, 240, 0.1) 100%);
            --text-primary: #2D2D3F;
            --text-secondary: #6B6B7B;
            --text-soft: #9B9BA5;
            --border-color: rgba(155, 137, 212, 0.2);
            --input-bg: #FFFFFF;
            --orb-1: #B19CD9;
            --orb-2: #9B8FD4;
            --orb-3: #7B9EF0;
            --sidebar-bg: rgba(255, 255, 255, 0.95);
            --quick-button-bg: rgba(255, 255, 255, 0.8);
            --quick-button-hover: rgba(155, 137, 212, 0.2);
            --breath-circle: rgba(155, 137, 212, 0.1);
            --dropdown-bg: rgba(255, 255, 255, 0.98);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --bg-gradient: radial-gradient(ellipse at top, #151832 0%, #0A0E27 40%, #000 100%);
            --header-bg: rgba(10, 14, 39, 0.95);
            --container-bg: rgba(21, 24, 50, 0.95);
            --message-bg: rgba(255, 255, 255, 0.05);
            --user-message-bg: linear-gradient(135deg, rgba(100, 181, 246, 0.2) 0%, rgba(155, 89, 182, 0.15) 100%);
            --text-primary: rgba(255, 255, 255, 0.95);
            --text-secondary: rgba(255, 255, 255, 0.75);
            --text-soft: rgba(255, 255, 255, 0.5);
            --border-color: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(255, 255, 255, 0.05);
            --orb-1: #9B59B6;
            --orb-2: #B19CD9;
            --orb-3: #64B5F6;
            --sidebar-bg: rgba(21, 24, 50, 0.95);
            --quick-button-bg: rgba(255, 255, 255, 0.05);
            --quick-button-hover: rgba(155, 89, 182, 0.3);
            --breath-circle: rgba(100, 181, 246, 0.05);
            --dropdown-bg: rgba(21, 24, 50, 0.98);
        }

        /* Dark theme message bubbles */
        [data-theme="dark"] .message-vera .message-bubble {
            background: linear-gradient(135deg, 
                rgba(155, 89, 182, 0.25) 0%, 
                rgba(177, 156, 217, 0.2) 50%,
                rgba(100, 181, 246, 0.15) 100%);
            border: 1px solid rgba(155, 89, 182, 0.4);
            box-shadow: 
                0 4px 20px rgba(155, 89, 182, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .message-user .message-bubble {
            background: linear-gradient(135deg, 
                rgba(100, 181, 246, 0.25) 0%, 
                rgba(123, 158, 240, 0.2) 100%);
            border: 1px solid rgba(100, 181, 246, 0.4);
            box-shadow: 
                0 4px 20px rgba(100, 181, 246, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Deep Dark Theme */
        [data-theme="deep"] {
            --bg-gradient: linear-gradient(180deg, #0A0A0A 0%, #000000 100%);
            --header-bg: rgba(0, 0, 0, 0.9);
            --container-bg: rgba(10, 10, 10, 0.95);
            --message-bg: rgba(255, 255, 255, 0.02);
            --user-message-bg: rgba(155, 137, 212, 0.05);
            --text-primary: rgba(255, 255, 255, 0.9);
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-soft: rgba(255, 255, 255, 0.4);
            --border-color: rgba(255, 255, 255, 0.05);
            --input-bg: rgba(255, 255, 255, 0.02);
            --orb-1: #6B5B8C;
            --orb-2: #7B6B9C;
            --orb-3: #5B7BA6;
            --sidebar-bg: rgba(10, 10, 10, 0.95);
            --quick-button-bg: rgba(255, 255, 255, 0.02);
            --quick-button-hover: rgba(255, 255, 255, 0.05);
            --breath-circle: rgba(255, 255, 255, 0.02);
            --dropdown-bg: rgba(10, 10, 10, 0.98);
        }

        /* Deep dark theme message bubbles */
        [data-theme="deep"] .message-vera .message-bubble {
            background: linear-gradient(135deg, 
                rgba(107, 91, 140, 0.3) 0%, 
                rgba(123, 107, 156, 0.25) 50%,
                rgba(91, 123, 166, 0.2) 100%);
            border: 1px solid rgba(107, 91, 140, 0.5);
            box-shadow: 
                0 4px 20px rgba(107, 91, 140, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        [data-theme="deep"] .message-user .message-bubble {
            background: linear-gradient(135deg, 
                rgba(91, 123, 166, 0.3) 0%, 
                rgba(100, 140, 180, 0.25) 100%);
            border: 1px solid rgba(91, 123, 166, 0.5);
            box-shadow: 
                0 4px 20px rgba(91, 123, 166, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: all 0.3s ease;
        }

        /* Living Background */
        .living-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .breath-circle {
            position: absolute;
            width: 400px;
            height: 400px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--breath-circle) 0%, transparent 70%);
            animation: breathe 8s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.3); opacity: 0.6; }
        }

        /* Header */
        .chat-header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--header-bg);
            backdrop-filter: blur(20px);
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .vera-identity {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .menu-toggle {
            width: 40px;
            height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 4px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            position: relative;
            border-radius: 8px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .menu-toggle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 8px;
            background: var(--quick-button-hover);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .menu-toggle:hover::before {
            width: 100%;
            height: 100%;
        }

        .menu-toggle:hover {
            transform: scale(1.1);
        }

        .menu-toggle:active {
            transform: scale(0.95);
        }

        .menu-line {
            width: 24px;
            height: 2px;
            background: var(--text-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
        }

        .menu-toggle:hover .menu-line {
            width: 20px;
        }

        .menu-toggle:hover .menu-line:nth-child(2) {
            width: 24px;
        }

        /* Hamburger Dropdown Menu */
        .hamburger-dropdown {
            position: absolute;
            top: 70px;
            left: 1rem;
            background: var(--dropdown-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            min-width: 280px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .hamburger-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 1rem 1.25rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--quick-button-hover);
        }

        .dropdown-item.danger {
            color: #ef4444;
        }

        .dropdown-item.danger:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        .vera-presence-indicator {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--orb-3) 0%, var(--orb-2) 50%, var(--orb-1) 100%);
            animation: presencePulse 4s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(155, 137, 212, 0.5);
            position: relative;
            overflow: hidden;
        }

        /* Shimmer on presence indicator */
        .vera-presence-indicator::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            animation: presenceShimmer 4s linear infinite;
        }

        @keyframes presenceShimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        @keyframes presencePulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 20px rgba(155, 137, 212, 0.4);
            }
            50% { 
                transform: scale(1.1); 
                box-shadow: 0 0 40px rgba(155, 137, 212, 0.7);
            }
        }

        .vera-title {
            display: flex;
            flex-direction: column;
        }

        .vera-title h1 {
            font-size: 1.3rem;
            font-weight: 400;
            letter-spacing: 0.15em;
            color: var(--text-primary);
        }

        .status-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--quick-button-bg);
            border-radius: 20px;
            border: 1px solid var(--border-color);
        }

        .theme-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
        }

        .theme-option::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(155, 137, 212, 0.2) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .theme-option:hover::after {
            width: 60px;
            height: 60px;
        }

        .theme-option:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .theme-option.active {
            border-color: var(--orb-1);
            transform: scale(1.15);
            box-shadow: 0 0 15px rgba(155, 137, 212, 0.4);
        }

        .theme-option.active::after {
            width: 60px;
            height: 60px;
        }

        .theme-light {
            background: linear-gradient(135deg, #E8D5F2, #D4C5F9);
        }

        .theme-dark {
            background: linear-gradient(135deg, #151832, #0A0E27);
        }

        .theme-deep {
            background: linear-gradient(135deg, #0A0A0A, #000000);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Welcome Container */
        .welcome-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            z-index: 10;
            animation: welcomeFadeIn 1.2s ease-out;
        }

        @keyframes welcomeFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .vera-orb-large {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle at 40% 40%, var(--orb-3) 0%, var(--orb-2) 35%, var(--orb-1) 70%);
            border-radius: 50%;
            margin-bottom: 2rem;
            animation: gentlePulse 4s infinite, float 6s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        /* Shimmer effect on orb */
        .vera-orb-large::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.15),
                transparent
            );
            animation: orbShimmer 3s linear infinite;
        }

        @keyframes orbShimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        @keyframes gentlePulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 20px 60px rgba(155, 137, 212, 0.3);
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 30px 80px rgba(155, 137, 212, 0.5);
            }
        }

        .welcome-text {
            text-align: center;
            max-width: 600px;
        }

        .welcome-text h2 {
            font-size: 1.8rem;
            font-weight: 300;
            margin-bottom: 1rem;
            color: var(--text-primary);
            animation: titleReveal 1s ease-out 0.3s backwards;
        }

        @keyframes titleReveal {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-text p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            animation: subtitleReveal 1s ease-out 0.6s backwards;
        }

        @keyframes subtitleReveal {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Quick Start Buttons */
        .quick-starts {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 2rem;
            max-width: 500px;
            animation: buttonsReveal 1s ease-out 0.9s backwards;
        }

        @keyframes buttonsReveal {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .quick-start-label {
            color: var(--text-soft);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            text-align: center;
            width: 100%;
        }

        .quick-button {
            padding: 0.75rem 1.5rem;
            background: var(--quick-button-bg);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }

        /* Living glow effect */
        .quick-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(155, 137, 212, 0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .quick-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .quick-button:hover {
            background: var(--quick-button-hover);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 25px rgba(155, 137, 212, 0.3),
                0 0 40px rgba(155, 137, 212, 0.2);
            border-color: var(--orb-2);
        }

        .quick-button:active {
            transform: translateY(-1px) scale(0.98);
        }

        /* Chat Container */
        .chat-container {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            z-index: 10;
        }

        .chat-container.active {
            display: block;
        }

        /* Messages */
        .message {
            margin-bottom: 1.5rem;
            animation: messageAppear 0.5s ease-out;
        }

        @keyframes messageAppear {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .message-vera {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .vera-avatar {
            width: 42px;
            height: 42px;
            background: radial-gradient(circle at 40% 40%, var(--orb-3) 0%, var(--orb-2) 50%, var(--orb-1) 100%);
            border-radius: 50%;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(155, 137, 212, 0.3);
            animation: avatarPulse 3s ease-in-out infinite;
        }

        @keyframes avatarPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(155, 137, 212, 0.3);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 4px 20px rgba(155, 137, 212, 0.5);
            }
        }

        .message-bubble {
            background: var(--message-bg);
            border: 1px solid var(--border-color);
            border-radius: 18px;
            padding: 1.2rem 1.5rem;
            max-width: 70%;
            color: var(--text-primary);
            line-height: 1.7;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
            position: relative;
            backdrop-filter: blur(10px);
        }

        /* Beautiful warm gradient for VERA's messages */
        .message-vera .message-bubble {
            background: linear-gradient(135deg, 
                rgba(177, 156, 217, 0.15) 0%, 
                rgba(155, 143, 212, 0.12) 50%,
                rgba(123, 158, 240, 0.1) 100%);
            border: 1px solid rgba(155, 137, 212, 0.3);
            box-shadow: 
                0 4px 20px rgba(155, 137, 212, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* Shimmer on VERA's messages */
        .message-vera .message-bubble::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .message-vera .message-bubble:hover::before {
            left: 100%;
        }

        .message-user {
            display: flex;
            justify-content: flex-end;
        }

        .message-user .message-bubble {
            background: linear-gradient(135deg, 
                rgba(123, 158, 240, 0.2) 0%, 
                rgba(100, 181, 246, 0.15) 100%);
            border: 1px solid rgba(123, 158, 240, 0.3);
            box-shadow: 
                0 4px 20px rgba(123, 158, 240, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .typing-indicator.active {
            display: flex;
            animation: messageAppear 0.5s ease-out;
        }

        .typing-dots {
            display: flex;
            gap: 0.4rem;
            padding: 1.2rem 1.5rem;
            background: linear-gradient(135deg, 
                rgba(177, 156, 217, 0.15) 0%, 
                rgba(155, 143, 212, 0.12) 50%,
                rgba(123, 158, 240, 0.1) 100%);
            border: 1px solid rgba(155, 137, 212, 0.3);
            border-radius: 18px;
            backdrop-filter: blur(10px);
            box-shadow: 
                0 4px 20px rgba(155, 137, 212, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* Dark theme typing dots */
        [data-theme="dark"] .typing-dots {
            background: linear-gradient(135deg, 
                rgba(155, 89, 182, 0.25) 0%, 
                rgba(177, 156, 217, 0.2) 50%,
                rgba(100, 181, 246, 0.15) 100%);
            border: 1px solid rgba(155, 89, 182, 0.4);
            box-shadow: 
                0 4px 20px rgba(155, 89, 182, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Deep dark theme typing dots */
        [data-theme="deep"] .typing-dots {
            background: linear-gradient(135deg, 
                rgba(107, 91, 140, 0.3) 0%, 
                rgba(123, 107, 156, 0.25) 50%,
                rgba(91, 123, 166, 0.2) 100%);
            border: 1px solid rgba(107, 91, 140, 0.5);
            box-shadow: 
                0 4px 20px rgba(107, 91, 140, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--orb-1);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
            box-shadow: 0 0 8px rgba(155, 137, 212, 0.3);
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingBounce {
            0%, 60%, 100% {
                transform: translateY(0);
                box-shadow: 0 0 8px rgba(155, 137, 212, 0.3);
            }
            30% {
                transform: translateY(-12px);
                box-shadow: 0 4px 12px rgba(155, 137, 212, 0.5);
            }
        }

        /* Input Container */
        .input-container {
            padding: 1.5rem;
            background: var(--header-bg);
            backdrop-filter: blur(20px);
            z-index: 100;
            border-top: 1px solid var(--border-color);
            position: relative;
            transition: all 0.3s;
        }

        /* Subtle glow when input is focused */
        .input-container.focused {
            background: var(--container-bg);
            box-shadow: 0 -5px 30px rgba(155, 137, 212, 0.1);
        }

        .input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .message-input {
            flex: 1;
            padding: 1rem 1.25rem;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            outline: none;
            font-size: 1rem;
            color: var(--text-primary);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            position: relative;
        }

        .message-input::placeholder {
            color: var(--text-soft);
            transition: all 0.3s;
        }

        .message-input:focus {
            border-color: var(--orb-1);
            box-shadow: 
                0 0 0 3px rgba(155, 137, 212, 0.15),
                0 8px 24px rgba(155, 137, 212, 0.2);
            transform: translateY(-1px);
        }

        .message-input:focus::placeholder {
            transform: translateX(5px);
            opacity: 0.7;
        }

        .send-button {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--orb-1), var(--orb-3));
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(155, 137, 212, 0.3);
        }

        /* Shimmer effect on send button */
        .send-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            animation: buttonShimmer 3s linear infinite;
        }

        @keyframes buttonShimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        /* Ripple effect on hover */
        .send-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .send-button:hover::after {
            width: 120px;
            height: 120px;
        }

        .send-button:hover:not(:disabled) {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 
                0 8px 30px rgba(155, 137, 212, 0.5),
                0 0 40px rgba(155, 137, 212, 0.3);
        }

        .send-button:active:not(:disabled) {
            transform: scale(0.95) rotate(5deg);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            animation: none;
        }

        .send-button:disabled::before,
        .send-button:disabled::after {
            display: none;
        }

        /* Breathing pulse when ready */
        .send-button:not(:disabled) {
            animation: sendButtonPulse 3s ease-in-out infinite;
        }

        @keyframes sendButtonPulse {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(155, 137, 212, 0.3);
            }
            50% {
                box-shadow: 0 4px 20px rgba(155, 137, 212, 0.5);
            }
        }

        .send-button svg {
            position: relative;
            z-index: 1;
        }

        /* Input Mic Button */
        .input-mic {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--quick-button-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            margin-right: 0.75rem;
        }

        .input-mic:hover {
            transform: scale(1.1);
            border-color: var(--orb-1);
            box-shadow: 0 4px 15px rgba(155, 137, 212, 0.3);
        }

        .input-mic.active {
            background: var(--orb-1);
            color: white;
            border-color: var(--orb-1);
            animation: voicePulse 1.5s infinite;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--container-bg);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .modal-content {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-cancel {
            background: var(--quick-button-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .modal-btn-cancel:hover {
            background: var(--quick-button-hover);
        }

        .modal-btn-danger {
            background: #ef4444;
            color: white;
        }

        .modal-btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }

        /* History Modal */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
        }

        .history-item {
            padding: 1rem;
            background: var(--message-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: var(--quick-button-hover);
            transform: translateX(5px);
        }

        .history-date {
            font-size: 0.75rem;
            color: var(--text-soft);
            margin-bottom: 0.25rem;
        }

        .history-preview {
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--orb-1);
        }

        /* Biometric Dashboard */
        .biometric-panel {
            position: fixed;
            top: 90px;
            right: 1rem;
            width: 280px;
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            transform: translateX(calc(100% + 1rem));
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            visibility: hidden;
        }

        .biometric-panel.active {
            transform: translateX(0);
            visibility: visible;
        }

        /* Backdrop for mobile biometric panel */
        .biometric-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(2px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            display: none; /* Hidden on desktop */
        }

        .biometric-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        .biometric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .biometric-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .biometric-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
        }

        .biometric-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .biometric-metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .metric-value {
            color: var(--text-primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--orb-2);
        }

        .metric-status.elevated {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }

        .metric-status.high {
            background: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* Voice Controls */
        .voice-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .voice-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--quick-button-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        /* Glow effect for voice toggles */
        .voice-toggle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(155, 137, 212, 0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .voice-toggle:hover::before {
            width: 100px;
            height: 100px;
        }

        .voice-toggle:hover {
            transform: scale(1.1);
            border-color: var(--orb-1);
            box-shadow: 0 4px 15px rgba(155, 137, 212, 0.3);
        }

        .voice-toggle svg {
            position: relative;
            z-index: 1;
            transition: all 0.3s;
        }

        .voice-toggle:hover svg {
            transform: scale(1.1);
        }

        .voice-toggle.active {
            background: var(--orb-1);
            color: white;
            border-color: var(--orb-1);
            animation: voicePulse 1.5s infinite;
        }

        @keyframes voicePulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 15px rgba(155, 137, 212, 0.5);
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 0 25px rgba(155, 137, 212, 0.7);
            }
        }

        /* Breathing Exercise */
        

        .breathing-overlay.active {
            display: flex;
        }

        

        

        

        

        

        

        /* Crisis Alert */
        .crisis-alert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(239, 68, 68, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 4000;
            backdrop-filter: blur(5px);
        }

        .crisis-alert.active {
            display: flex;
        }

        .crisis-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .crisis-title {
            color: #dc2626;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .crisis-message {
            color: #374151;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .crisis-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .crisis-btn {
            padding: 1rem 2rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .crisis-btn-primary {
            background: #dc2626;
            color: white;
        }

        .crisis-btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        /* Enhanced Message Bubbles */
        .message-bubble {
            position: relative;
            overflow: hidden;
        }

        .message-bubble::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .message-bubble.shimmer::before {
            left: 100%;
        }

        /* Wellness Insights */
        .wellness-card {
            background: var(--message-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .wellness-header {
            margin-bottom: 1rem;
        }

        .wellness-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--orb-1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .wellness-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .wellness-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Breathing Guidance Orb */
        .breathing-guidance {
            text-align: center;
        }

        .breathing-orb-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            margin: 2rem 0;
        }

        .breathing-orb {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, 
                var(--orb-3) 0%, 
                var(--orb-2) 50%, 
                var(--orb-1) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 60px rgba(155, 137, 212, 0.4),
                0 0 120px rgba(100, 181, 246, 0.3);
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .breathing-orb.breathing {
            animation: breathingCycle 8s infinite ease-in-out;
        }

        @keyframes breathingCycle {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 
                    0 0 60px rgba(155, 137, 212, 0.4),
                    0 0 120px rgba(100, 181, 246, 0.3);
            }
            25% { 
                transform: scale(1.2);
                box-shadow: 
                    0 0 80px rgba(155, 137, 212, 0.6),
                    0 0 160px rgba(100, 181, 246, 0.5);
            }
            50% { 
                transform: scale(1.3);
                box-shadow: 
                    0 0 100px rgba(155, 137, 212, 0.8),
                    0 0 200px rgba(100, 181, 246, 0.7);
            }
            75% { 
                transform: scale(1.2);
                box-shadow: 
                    0 0 80px rgba(155, 137, 212, 0.6),
                    0 0 160px rgba(100, 181, 246, 0.5);
            }
        }

        .orb-inner {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .breath-text {
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .breathing-instructions {
            max-width: 300px;
        }

        .breathing-instructions p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            font-size: 1rem;
            line-height: 1.6;
        }

        .breathing-control-btn {
            padding: 0.75rem 2rem;
            background: linear-gradient(135deg, var(--orb-1), var(--orb-3));
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(155, 137, 212, 0.3);
        }

        .breathing-control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(155, 137, 212, 0.5);
        }

        /* Mobile */
        @media (max-width: 768px) {
            .chat-header {
                flex-direction: column;
                padding: 0.75rem 1rem;
                padding-top: max(0.75rem, env(safe-area-inset-top));
                gap: 0.75rem;
            }

            .vera-identity {
                width: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .header-controls {
                width: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 1rem;
            }

            .voice-controls {
                display: flex;
                gap: 0.75rem;
                flex-shrink: 0;
            }

            .theme-toggle {
                display: flex;
                gap: 0.5rem;
                justify-content: center;
                flex: 1;
                padding: 0.5rem;
                background: var(--quick-button-bg);
                border-radius: 25px;
                border: 1px solid var(--border-color);
            }

            .theme-option {
                width: 32px;
                height: 32px;
            }

            .voice-toggle {
                width: 48px;
                height: 48px;
                min-width: 48px;
            }

            .menu-toggle {
                width: 48px;
                height: 48px;
            }

            .vera-presence-indicator {
                width: 40px;
                height: 40px;
            }

            .vera-title h1 {
                font-size: 1.2rem;
                letter-spacing: 0.1em;
            }

            .status-text {
                font-size: 0.75rem;
            }

            .hamburger-dropdown {
                width: calc(100% - 2rem);
                left: 1rem;
                right: 1rem;
            }

            /* Welcome screen mobile */
            .vera-orb-large {
                width: 100px;
                height: 100px;
                margin-bottom: 1.5rem;
            }

            .welcome-text h2 {
                font-size: 1.5rem;
            }

            .welcome-text p {
                font-size: 1rem;
                padding: 0 1rem;
            }

            .quick-starts {
                gap: 0.5rem;
                padding: 0 1rem;
            }

            .quick-button {
                padding: 0.75rem 1.25rem;
                font-size: 0.95rem;
                width: 100%;
            }

            .message-bubble {
                max-width: 85%;
            }

            /* Chat container mobile */
            .chat-container {
                padding: 1rem;
            }

            .welcome-container {
                padding: 1.5rem 1rem;
            }

            .biometric-backdrop {
                display: block; /* Show on mobile */
            }

            .biometric-panel {
                width: calc(100% - 2rem);
                left: 1rem;
                right: 1rem;
                top: auto;
                bottom: 0;
                border-radius: 16px 16px 0 0;
                transform: translateY(calc(100% + 1rem));
                visibility: hidden;
                max-height: 70vh;
                overflow-y: auto;
            }

            .biometric-panel.active {
                transform: translateY(0);
                bottom: 0;
                visibility: visible;
            }

            /* Input area mobile */
            .input-container {
                padding: 1rem;
                padding-bottom: max(1rem, env(safe-area-inset-bottom));
            }

            .input-wrapper {
                gap: 0.75rem;
            }

            .message-input {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 0.875rem 1rem;
            }

            .send-button {
                width: 52px;
                height: 52px;
                min-width: 52px;
                flex-shrink: 0;
            }

            /* Subscription modal mobile */
            .subscription-content {
                padding: 2rem 1.5rem;
                width: 95%;
            }

            .subscription-title {
                font-size: 1.6rem;
            }

            .subscription-vera-message {
                font-size: 1rem;
            }

            .subscription-price {
                font-size: 2rem;
            }
        }

        /* Subscription Modal - DRAMATIC & BEAUTIFUL */
        .subscription-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.6s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .subscription-modal.active {
            display: flex;
        }

        .subscription-content {
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 3rem 2.5rem;
            max-width: 520px;
            width: 90%;
            text-align: center;
            animation: modalSlideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 100px rgba(155, 137, 212, 0.2);
        }

        /* Animated background glow */
        .subscription-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(155, 137, 212, 0.1) 0%, transparent 70%);
            animation: glowRotate 8s linear infinite;
        }

        @keyframes glowRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .subscription-orb {
            width: 100px;
            height: 100px;
            margin: 0 auto 2rem;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--orb-3) 0%, var(--orb-2) 50%, var(--orb-1) 100%);
            box-shadow: 
                0 0 60px rgba(155, 137, 212, 0.6),
                0 0 100px rgba(155, 137, 212, 0.4);
            animation: dramaticPulse 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }

        @keyframes dramaticPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 
                    0 0 60px rgba(155, 137, 212, 0.6),
                    0 0 100px rgba(155, 137, 212, 0.4);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 
                    0 0 80px rgba(155, 137, 212, 0.8),
                    0 0 140px rgba(155, 137, 212, 0.6);
            }
        }

        .subscription-title {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            line-height: 1.3;
            position: relative;
            z-index: 1;
            background: linear-gradient(135deg, var(--orb-1), var(--orb-3));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subscription-vera-message {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 2rem;
            font-size: 1.15rem;
            position: relative;
            z-index: 1;
            font-style: italic;
        }

        .subscription-vera-message strong {
            color: var(--text-primary);
            font-weight: 600;
            font-style: normal;
        }

        .subscription-offer {
            background: linear-gradient(135deg, 
                rgba(155, 137, 212, 0.15) 0%, 
                rgba(123, 158, 240, 0.1) 100%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .subscription-trial {
            color: var(--orb-3);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .subscription-price {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--orb-1), var(--orb-3));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subscription-details {
            color: var(--text-soft);
            font-size: 0.95rem;
        }

        .subscription-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .subscription-btn {
            padding: 1.2rem 2.5rem;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1.05rem;
            position: relative;
            overflow: hidden;
        }

        .subscription-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .subscription-btn:hover::before {
            width: 400px;
            height: 400px;
        }

        .subscription-btn span {
            position: relative;
            z-index: 1;
        }

        .subscription-btn-primary {
            background: linear-gradient(135deg, var(--orb-1), var(--orb-3));
            color: white;
            box-shadow: 
                0 6px 30px rgba(155, 137, 212, 0.4),
                0 0 40px rgba(155, 137, 212, 0.2);
            animation: primaryButtonPulse 3s ease-in-out infinite;
        }

        @keyframes primaryButtonPulse {
            0%, 100% {
                box-shadow: 
                    0 6px 30px rgba(155, 137, 212, 0.4),
                    0 0 40px rgba(155, 137, 212, 0.2);
            }
            50% {
                box-shadow: 
                    0 8px 40px rgba(155, 137, 212, 0.6),
                    0 0 60px rgba(155, 137, 212, 0.3);
            }
        }

        .subscription-btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 10px 50px rgba(155, 137, 212, 0.6),
                0 0 80px rgba(155, 137, 212, 0.4);
        }

        .subscription-btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .subscription-btn-secondary:hover {
            background: var(--quick-button-hover);
            border-color: var(--orb-2);
        }

        .subscription-guarantee {
            margin-top: 1.5rem;
            font-size: 0.85rem;
            color: var(--text-soft);
            position: relative;
            z-index: 1;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .subscription-content {
                padding: 2rem 1.5rem;
            }

            .subscription-title {
                font-size: 1.6rem;
            }

            .subscription-vera-message {
                font-size: 1rem;
            }

            .subscription-price {
                font-size: 2rem;
            }
        }

        .message-counter {
            display: none; /* Hidden - keep subscription logic working */
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--message-bg);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

    </style>
</head>
<body data-theme="light">
    <!-- Living Background -->
    <div class="living-background">
        <div class="breath-circle" style="top: 10%; left: 5%;"></div>
        <div class="breath-circle" style="top: 50%; right: 10%; animation-delay: 3s;"></div>
        <div class="breath-circle" style="bottom: 10%; left: 40%; animation-delay: 6s;"></div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="chat-header">
        <div class="vera-identity">
                <button class="menu-toggle" onclick="toggleMenu()" id="menuToggle">
                    <span class="menu-line"></span>
                    <span class="menu-line"></span>
                    <span class="menu-line"></span>
                </button>

                <!-- Hamburger Dropdown -->
                <div class="hamburger-dropdown" id="hamburgerDropdown">
                    <div class="dropdown-item" onclick="goHome()">
                        <span>← Back to Home</span>
                    </div>
                    <div class="dropdown-item" onclick="startNewChat()">
                        <span>New Chat</span>
                    </div>
                    
                    <div class="dropdown-item" onclick="showWellnessDashboard()">
                        <span>Wellness Insights</span>
                    </div>
                    <div class="dropdown-item" onclick="showConversationHistory()">
                        <span>Conversation History</span>
                    </div>
                    <div class="dropdown-item" onclick="exportChatData()">
                        <span>Export Chat Data</span>
                    </div>
                    <div class="dropdown-item" onclick="showPrivacyControls()">
                        <span>Privacy Controls</span>
                    </div>
                    <div class="dropdown-item danger" onclick="showDeleteConfirmation()">
                        <span>Delete My Data</span>
                    </div>
                    <div class="dropdown-item" onclick="showEmailPreferences()">
                        <span>Email Preferences</span>
                    </div>
                </div>

                <div class="vera-presence-indicator"></div>
                <div class="vera-title">
                    <h1>VERA</h1>
                    <span class="status-text" id="statusText">I'm here with you</span>
                </div>
            </div>
            
            <div class="header-controls">
                <div class="voice-controls">
                    <button class="voice-toggle" onclick="toggleBiometrics()" title="Health Monitor">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3z"/>
                        </svg>
                    </button>
                </div>
                <div class="theme-toggle">
                    <div class="theme-option theme-light active" onclick="setTheme('light')" title="Light"></div>
                    <div class="theme-option theme-dark" onclick="setTheme('dark')" title="Dark"></div>
                    <div class="theme-option theme-deep" onclick="setTheme('deep')" title="Deep Dark"></div>
                </div>
            </div>
        </header>

        <!-- Welcome Container -->
        <div class="welcome-container" id="welcomeContainer">
            <div class="vera-orb-large"></div>
            <div class="welcome-text">
                <h2 id="welcomeTitle">I'm VERA. I'm here for you.</h2>
                <p>This is a space where your nervous system is understood—where what you're feeling matters. No rush, no judgment. Just us.</p>
            </div>
            
            <div class="quick-starts">
                <button class="quick-button" onclick="quickStart('I don\'t know where to start')">I don't know where to start</button>
                <button class="quick-button" onclick="quickStart('My chest is tight and I can\'t breathe')">My chest is tight</button>
                <button class="quick-button" onclick="quickStart('Everything feels heavy today')">Everything feels heavy</button>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container" id="chatContainer"></div>

        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator">
            <div class="vera-avatar"></div>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-container">
            <div class="input-wrapper">
                <button class="voice-toggle input-mic" onclick="toggleVoice()" title="Voice Mode">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                </button>
                <input 
                    type="text" 
                    id="messageInput" 
                    class="message-input" 
                    placeholder="What's present in your body right now..."
                />
                <button class="send-button" onclick="sendMessage()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-header">Delete All Your Data?</div>
            <div class="modal-content">
                <p>This will permanently delete:</p>
                <ul style="margin: 1rem 0; padding-left: 1.5rem; color: var(--text-secondary);">
                    <li>All your conversation history with VERA</li>
                    <li>Your account information</li>
                    <li>All stored preferences</li>
                </ul>
                <p style="color: #ef4444; font-weight: 600;">This action cannot be undone.</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                <button class="modal-btn modal-btn-danger" onclick="confirmDeleteData()">Delete Everything</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal-overlay" id="historyModal">
        <div class="modal">
            <div class="modal-header">Conversation History</div>
            <div class="history-list" id="historyList">
                <!-- History items loaded dynamically -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeHistoryModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Email Preferences Modal -->
    <div class="modal-overlay" id="emailModal">
        <div class="modal">
            <div class="modal-header">Email Preferences</div>
            <div class="modal-content">
                <p>Email preferences coming soon! You'll be able to:</p>
                <ul style="margin: 1rem 0; padding-left: 1.5rem; color: var(--text-secondary);">
                    <li>Manage notification settings</li>
                    <li>Set reminder preferences</li>
                    <li>Control marketing communications</li>
                </ul>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeEmailModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Biometric Backdrop (for mobile) -->
    <div class="biometric-backdrop" id="biometricBackdrop" onclick="toggleBiometrics()"></div>

    <!-- Biometric Panel -->
    <div class="biometric-panel" id="biometricPanel">
        <div class="biometric-header">
            <div class="biometric-title">Health Monitor</div>
            <button class="biometric-close" onclick="toggleBiometrics()">×</button>
        </div>
        <div class="biometric-metric">
            <div class="metric-label">Heart Rate</div>
            <div class="metric-value">
                <span id="heartRate">--</span> BPM
                <div class="metric-status" id="heartRateStatus"></div>
            </div>
        </div>
        <div class="biometric-metric">
            <div class="metric-label">Stress Level</div>
            <div class="metric-value">
                <span id="stressLevel">Low</span>
                <div class="metric-status" id="stressStatus"></div>
            </div>
        </div>
        <div class="biometric-metric">
            <div class="metric-label">Breathing Rate</div>
            <div class="metric-value">
                <span id="breathingRate">--</span> /min
                <div class="metric-status" id="breathingStatus"></div>
            </div>
        </div>
        <div class="biometric-metric">
            <div class="metric-label">Monitoring</div>
            <div class="metric-value">
                <button class="quick-button" onclick="toggleBiometricMonitoring()" id="monitoringBtn">Start</button>
            </div>
        </div>
    </div>

    <!-- Breathing Exercise -->
    <div class="breathing-overlay" id="breathingOverlay" style="display: none;">
        <div class="breathing-controls">
            <button class="breathing-btn" onclick="startBreathing()">Start</button>
            <button class="breathing-btn" onclick="stopBreathingExercise()">Close</button>
        </div>
    </div>

    <!-- Crisis Alert -->
    <div class="crisis-alert" id="crisisAlert">
        <div class="crisis-content">
            <div class="crisis-title">I'm Here With You</div>
            <div class="crisis-message">
                You're not alone. If you're having thoughts of self-harm or suicide, please reach out for immediate help.
            </div>
            <div class="crisis-actions">
                <button class="crisis-btn crisis-btn-primary" onclick="callCrisisLine()">Call Crisis Helpline</button>
                <button class="crisis-btn crisis-btn-secondary" onclick="closeCrisisAlert()">I'm Safe</button>
            </div>
        </div>
    </div>

    <!-- Privacy Controls Modal -->
    <div class="modal-overlay" id="privacyModal">
        <div class="modal">
            <div class="modal-header">Privacy Controls</div>
            <div class="modal-content">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <input type="checkbox" id="biometricConsent" checked> 
                        <span>Allow biometric monitoring</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <input type="checkbox" id="voiceConsent" checked> 
                        <span>Enable voice interactions</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <input type="checkbox" id="analyticsConsent" checked> 
                        <span>Share anonymous analytics</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="crisisConsent" checked> 
                        <span>Enable crisis intervention detection</span>
                    </label>
                </div>
                <p style="font-size: 0.85rem; color: var(--text-soft); line-height: 1.5;">
                    Your data is encrypted and stored securely. You can change these preferences anytime.
                </p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closePrivacyModal()">Save</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GLOBAL STATE
        // ============================================
        
        let userEmail = null;
        let userName = null;
        const messageInput = document.getElementById('messageInput');
        const chatContainer = document.getElementById('chatContainer');
        const welcomeContainer = document.getElementById('welcomeContainer');
        const typingIndicator = document.getElementById('typingIndicator');

        // Revolutionary Features State
        let biometricData = {
            heartRate: null,
            stressLevel: 0,
            breathingRate: null,
            isMonitoring: false
        };
        let voiceRecognition = null;
        let speechSynthesis = window.speechSynthesis;
        let emotionalState = {
            current: 'neutral',
            history: [],
            confidence: 0
        };
        let wellnessData = {
            dailyCheckins: 0,
            streakDays: 0,
            insights: []
        };
        let crisisMode = false;
        let isVoiceEnabled = false;
        let isBreathingMode = false;

        // ============================================
        // INITIALIZATION
        // ============================================

       document.addEventListener('DOMContentLoaded', () => {
    // Get email from URL
    const urlParams = new URLSearchParams(window.location.search);
    const emailParam = urlParams.get('email');
    
    // Validate email (not a placeholder and contains @)
    if (emailParam && 
        emailParam.includes('@') && 
        !emailParam.includes('{CUSTOMER_EMAIL}') &&
        !emailParam.includes('{{CUSTOMER_EMAIL}}')) {
        
        userEmail = emailParam.trim();
        userName = userEmail.split('@')[0].charAt(0).toUpperCase() + userEmail.split('@')[0].slice(1);
    } else {
        // Invalid or placeholder email
        userName = 'friend';
        userEmail = null;
    }
    
    // Load saved theme
    const savedTheme = localStorage.getItem('veraTheme') || 'light';
    setTheme(savedTheme);
    
    // Setup event listeners
    messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    // Add glow effect to input container when focused
    const inputContainer = document.querySelector('.input-container');
    messageInput.addEventListener('focus', () => {
        inputContainer.classList.add('focused');
    });
    messageInput.addEventListener('blur', () => {
        inputContainer.classList.remove('focused');
    });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('hamburgerDropdown');
                const menuToggle = document.getElementById('menuToggle');
                const biometricPanel = document.getElementById('biometricPanel');
                if (!dropdown.contains(e.target) && !menuToggle.contains(e.target)) {
                    dropdown.classList.remove('active');
                }
                if (!biometricPanel.contains(e.target)) {
                    // Keep panel open if clicking inside
                }
            });

            // Initialize revolutionary features
            initializeVoiceRecognition();
            initializeBiometricSimulation();
            loadPrivacyPreferences();

            // Update status text
            updateStatusMessages();

            // Check if returning user and greet them
            if (userEmail) {
                checkAndGreetUser();
            }
        });

        // ============================================
        // BIOMETRIC MONITORING SYSTEM
        // ============================================

        function initializeBiometricSimulation() {
            // Simulate realistic biometric data
            setInterval(() => {
                if (biometricData.isMonitoring) {
                    updateBiometricData();
                }
            }, 2000);
        }

        function updateBiometricData() {
            // Simulate heart rate (60-100 normal, stress can increase)
            const baseHR = 65 + Math.random() * 25;
            const stressMultiplier = biometricData.stressLevel * 0.3;
            biometricData.heartRate = Math.round(baseHR + stressMultiplier);

            // Simulate breathing rate (12-20 normal)
            biometricData.breathingRate = Math.round(14 + Math.random() * 6 + stressMultiplier * 0.2);

            // Update UI
            document.getElementById('heartRate').textContent = biometricData.heartRate;
            document.getElementById('breathingRate').textContent = biometricData.breathingRate;

            // Update status indicators
            updateBiometricStatus();
        }

        function updateBiometricStatus() {
            const hrStatus = document.getElementById('heartRateStatus');
            const stressStatus = document.getElementById('stressStatus');
            const breathingStatus = document.getElementById('breathingStatus');

            // Heart rate status
            if (biometricData.heartRate > 100) {
                hrStatus.className = 'metric-status high';
            } else if (biometricData.heartRate > 85) {
                hrStatus.className = 'metric-status elevated';
            } else {
                hrStatus.className = 'metric-status';
            }

            // Stress level status
            if (biometricData.stressLevel > 7) {
                stressStatus.className = 'metric-status high';
                document.getElementById('stressLevel').textContent = 'High';
            } else if (biometricData.stressLevel > 4) {
                stressStatus.className = 'metric-status elevated';
                document.getElementById('stressLevel').textContent = 'Moderate';
            } else {
                stressStatus.className = 'metric-status';
                document.getElementById('stressLevel').textContent = 'Low';
            }

            // Check for crisis indicators
            if (biometricData.stressLevel > 8 && biometricData.heartRate > 110) {
                setTimeout(() => checkForCrisisLanguage(), 1000);
            }
        }

        function toggleBiometrics() {
            const panel = document.getElementById('biometricPanel');
            const backdrop = document.getElementById('biometricBackdrop');
            panel.classList.toggle('active');
            backdrop.classList.toggle('active');
            
            // Prevent body scroll when panel is open on mobile
            if (panel.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        function toggleBiometricMonitoring() {
            biometricData.isMonitoring = !biometricData.isMonitoring;
            const btn = document.getElementById('monitoringBtn');

            if (biometricData.isMonitoring) {
                btn.textContent = 'Stop';
                btn.style.background = '#ef4444';
                updateBiometricData(); // Start immediately
            } else {
                btn.textContent = 'Start';
                btn.style.background = '';
            }
        }

        // ============================================
        // VOICE INTERACTION SYSTEM
        // ============================================

        function initializeVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                voiceRecognition = new SpeechRecognition();
                voiceRecognition.continuous = false;
                voiceRecognition.interimResults = false;
                voiceRecognition.lang = 'en-US';

                voiceRecognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    messageInput.value = transcript;
                    sendMessage();
                };

                voiceRecognition.onerror = (event) => {
                    console.log('Voice recognition error:', event.error);
                    stopVoiceMode();
                };

                voiceRecognition.onend = () => {
                    if (isVoiceEnabled) {
                        startVoiceListening();
                    }
                };
            }
        }

        function toggleVoice() {
            const voiceToggle = document.querySelector('.voice-toggle');
            isVoiceEnabled = !isVoiceEnabled;

            if (isVoiceEnabled) {
                startVoiceMode();
                voiceToggle.classList.add('active');
            } else {
                stopVoiceMode();
                voiceToggle.classList.remove('active');
            }
        }

        function startVoiceMode() {
            if (voiceRecognition) {
                startVoiceListening();
                speakText("Voice mode activated. I'm listening.");
            }
        }

        function stopVoiceMode() {
            if (voiceRecognition) {
                voiceRecognition.stop();
            }
            isVoiceEnabled = false;
        }

        function startVoiceListening() {
            if (voiceRecognition && isVoiceEnabled) {
                try {
                    voiceRecognition.start();
                } catch (error) {
                    console.log('Voice recognition start error:', error);
                }
            }
        }

        function speakText(text) {
            if (speechSynthesis && isVoiceEnabled) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                utterance.volume = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // ============================================
        // ADVANCED SENTIMENT ANALYSIS
        // ============================================

        function analyzeSentiment(text) {
            // Simple keyword-based sentiment analysis
            const positiveWords = ['happy', 'joy', 'good', 'great', 'wonderful', 'amazing', 'peaceful', 'calm', 'relaxed', 'grateful'];
            const negativeWords = ['sad', 'angry', 'hurt', 'pain', 'anxious', 'worried', 'scared', 'depressed', 'overwhelmed', 'stressed'];
            const crisisWords = ['suicide', 'kill myself', 'end it all', 'no point', 'hopeless', 'worthless', 'die', 'hurt myself'];

            const words = text.toLowerCase().split(/\s+/);
            let positiveScore = 0;
            let negativeScore = 0;
            let crisisScore = 0;

            words.forEach(word => {
                if (positiveWords.includes(word)) positiveScore++;
                if (negativeWords.includes(word)) negativeScore++;
                if (crisisWords.some(crisis => text.toLowerCase().includes(crisis))) crisisScore++;
            });

            // Update stress level based on sentiment
            if (crisisScore > 0) {
                biometricData.stressLevel = Math.min(10, biometricData.stressLevel + 3);
                triggerCrisisIntervention();
            } else if (negativeScore > positiveScore) {
                biometricData.stressLevel = Math.min(10, biometricData.stressLevel + 1);
            } else if (positiveScore > negativeScore) {
                biometricData.stressLevel = Math.max(0, biometricData.stressLevel - 1);
            }

            // Determine emotional state
            if (crisisScore > 0) {
                emotionalState.current = 'crisis';
            } else if (negativeScore > positiveScore + 1) {
                emotionalState.current = 'distressed';
            } else if (positiveScore > negativeScore + 1) {
                emotionalState.current = 'positive';
            } else {
                emotionalState.current = 'neutral';
            }

            emotionalState.history.push({
                state: emotionalState.current,
                timestamp: Date.now(),
                text: text.substring(0, 100)
            });
        }

        // ============================================
        // CRISIS INTERVENTION SYSTEM
        // ============================================

        function triggerCrisisIntervention() {
            crisisMode = true;
            document.getElementById('crisisAlert').classList.add('active');
        }

        function checkForCrisisLanguage() {
            if (biometricData.stressLevel > 8 && !crisisMode) {
                const recentMessages = Array.from(chatContainer.children)
                    .slice(-3)
                    .map(msg => msg.textContent)
                    .join(' ');

                if (recentMessages.toLowerCase().includes('hurt') || 
                    recentMessages.toLowerCase().includes('hopeless') ||
                    biometricData.heartRate > 120) {
                    triggerCrisisIntervention();
                }
            }
        }

        function callCrisisLine() {
            // In a real app, this would initiate a call or redirect
            window.open('tel:988', '_blank'); // National Suicide Prevention Lifeline
            closeCrisisAlert();
        }

        function closeCrisisAlert() {
            document.getElementById('crisisAlert').classList.remove('active');
            crisisMode = false;
            addMessage("I'm here with you. Let's take this one breath at a time.", 'vera');
        }

        // ============================================
        // BREATHING EXERCISE SYSTEM
        // ============================================

        function startBreathingExercise() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.remove('active');
            document.getElementById('breathingOverlay').classList.add('active');
            isBreathingMode = true;
        }

        function startBreathing() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            let isInhaling = true;
            let count = 0;

            const breathingCycle = () => {
                if (!isBreathingMode) return;

                if (isInhaling) {
                    text.textContent = 'Breathe in...';
                    circle.classList.add('inhale');
                    setTimeout(() => {
                        if (isBreathingMode) {
                            text.textContent = 'Hold...';
                            setTimeout(() => {
                                if (isBreathingMode) {
                                    isInhaling = false;
                                    breathingCycle();
                                }
                            }, 2000);
                        }
                    }, 4000);
                } else {
                    text.textContent = 'Breathe out...';
                    circle.classList.remove('inhale');
                    count++;
                    setTimeout(() => {
                        if (isBreathingMode) {
                            if (count < 10) {
                                isInhaling = true;
                                setTimeout(breathingCycle, 1000);
                            } else {
                                text.textContent = 'Well done. How do you feel?';
                                setTimeout(stopBreathingExercise, 3000);
                            }
                        }
                    }, 4000);
                }
            };

            breathingCycle();

            // Reduce stress level during breathing
            const stressReduction = setInterval(() => {
                if (isBreathingMode && biometricData.stressLevel > 0) {
                    biometricData.stressLevel = Math.max(0, biometricData.stressLevel - 0.5);
                } else {
                    clearInterval(stressReduction);
                }
            }, 2000);
        }

        function stopBreathingExercise() {
            document.getElementById('breathingOverlay').classList.remove('active');
            isBreathingMode = false;

            // Add wellness insight
            setTimeout(() => {
                addWellnessInsight('breathing', "Great job on that breathing exercise! Regular breathing practice can reduce stress by up to 50%.");
            }, 1000);
        }

        // ============================================
        // WELLNESS DASHBOARD SYSTEM
        // ============================================

        function showWellnessDashboard() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.remove('active');

            // Show breathing guidance orb first
            showBreathingGuidance();

            // Generate insights based on emotional history
            generateWellnessInsights();
        }

        function showBreathingGuidance() {
            const breathingDiv = document.createElement('div');
            breathingDiv.className = 'wellness-card breathing-guidance';

            breathingDiv.innerHTML = `
                <div class="wellness-header">
                    <div class="wellness-title">Breathing Guidance</div>
                </div>
                <div class="breathing-orb-container">
                    <div class="breathing-orb" id="breathingOrb">
                        <div class="orb-inner">
                            <div class="breath-text" id="breathText">Breathe</div>
                        </div>
                    </div>
                    <div class="breathing-instructions">
                        <p>Follow the gentle expansion and contraction of the orb</p>
                        <button class="breathing-control-btn" onclick="toggleBreathingGuide()" id="breathingBtn">Start Breathing</button>
                    </div>
                </div>
            `;

            chatContainer.appendChild(breathingDiv);
            breathingDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function generateWellnessInsights() {
            const insights = [];
            const recentStates = emotionalState.history.slice(-10);

            if (recentStates.filter(s => s.state === 'positive').length > 5) {
                insights.push({
                    type: 'positive',
                    title: 'Positive Trend Detected',
                    content: "I've noticed you've been expressing more positive emotions lately. This is wonderful progress!"
                });
            }

            if (biometricData.stressLevel < 3) {
                insights.push({
                    type: 'calm',
                    title: 'Calm State Achieved',
                    content: "Your stress levels are in a healthy range. Keep up the great self-care practices!"
                });
            }

            insights.forEach(insight => {
                addWellnessInsight(insight.type, insight.content, insight.title);
            });
        }

        function addWellnessInsight(type, content, title = 'Wellness Insight') {
            const insightDiv = document.createElement('div');
            insightDiv.className = 'wellness-card';

            insightDiv.innerHTML = `
                <div class="wellness-header">
                    <div class="wellness-title">${title}</div>
                </div>
                <div class="wellness-content">${content}</div>
            `;

            if (welcomeContainer.style.display !== 'none') {
                welcomeContainer.style.display = 'none';
                chatContainer.classList.add('active');
            }

            chatContainer.appendChild(insightDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // ============================================
        // BREATHING GUIDANCE CONTROLS
        // ============================================

        let breathingActive = false;

        function toggleBreathingGuide() {
            const orb = document.getElementById('breathingOrb');
            const btn = document.getElementById('breathingBtn');
            const breathText = document.getElementById('breathText');
            
            if (!breathingActive) {
                // Start breathing guidance
                breathingActive = true;
                orb.classList.add('breathing');
                btn.textContent = 'Stop Breathing';
                
                // Breathing cycle text changes
                const breathingCycle = () => {
                    if (!breathingActive) return;
                    
                    breathText.textContent = 'Breathe In';
                    setTimeout(() => {
                        if (!breathingActive) return;
                        breathText.textContent = 'Hold';
                        setTimeout(() => {
                            if (!breathingActive) return;
                            breathText.textContent = 'Breathe Out';
                            setTimeout(() => {
                                if (!breathingActive) return;
                                breathText.textContent = 'Rest';
                                setTimeout(breathingCycle, 1000);
                            }, 3000);
                        }, 1000);
                    }, 2000);
                };
                
                breathingCycle();
            } else {
                // Stop breathing guidance
                breathingActive = false;
                orb.classList.remove('breathing');
                btn.textContent = 'Start Breathing';
                breathText.textContent = 'Breathe';
            }
        }

        // ============================================
        // PRIVACY CONTROLS
        // ============================================

        function showPrivacyControls() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.remove('active');
            document.getElementById('privacyModal').classList.add('active');
        }

        function closePrivacyModal() {
            document.getElementById('privacyModal').classList.remove('active');
            savePrivacyPreferences();
        }

        function loadPrivacyPreferences() {
            const prefs = JSON.parse(localStorage.getItem('veraPrivacyPrefs') || '{}');

            document.getElementById('biometricConsent').checked = prefs.biometric !== false;
            document.getElementById('voiceConsent').checked = prefs.voice !== false;
            document.getElementById('analyticsConsent').checked = prefs.analytics !== false;
            document.getElementById('crisisConsent').checked = prefs.crisis !== false;
        }

        function savePrivacyPreferences() {
            const prefs = {
                biometric: document.getElementById('biometricConsent').checked,
                voice: document.getElementById('voiceConsent').checked,
                analytics: document.getElementById('analyticsConsent').checked,
                crisis: document.getElementById('crisisConsent').checked
            };

            localStorage.setItem('veraPrivacyPrefs', JSON.stringify(prefs));
        }

        // ============================================
        // AUTOMATIC GREETING FOR ALL USERS
        // ============================================

async function checkAndGreetUser() {
    try {
        // First check for session_id which indicates a new subscription
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');

        if (sessionId) {
            // Verify the subscription and show welcome message
            const verifyResponse = await fetch('/api/verify-subscription', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sessionId })
            });
            
            const verifyData = await verifyResponse.json();
            
            if (verifyData.success) {
                // Show chat with subscription welcome
                welcomeContainer.style.display = 'none';
                chatContainer.classList.add('active');
                
                // Add subscription welcome message
                setTimeout(() => {
                    addMessage(verifyData.welcomeMessage, 'vera');
                    setTimeout(() => {
                        addMessage("What's present for you right now? I'm here to listen.", 'vera');
                    }, 1000);
                }, 500);
                
                return; // Skip regular greeting flow
            }
        }

        // Regular greeting flow for returning users
        const response = await fetch('/api/check-history', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: userEmail })
        });
        
        const data = await response.json();
        
        // ONLY greet if they have history (returning users)
        if (data.hasHistory) {
            // Hide welcome, show chat with greeting
            welcomeContainer.style.display = 'none';
            chatContainer.classList.add('active');
            
            const returningGreetings = [
                `Hi ${userName}, I'm here with you again.`,
                `${userName}, glad you're back. What's present for you today?`,
                `Welcome back, ${userName}. I'm here, listening.`,
                `${userName}, I've been holding space for you. What's alive in your body right now?`,
                `Hi ${userName}. I'm here. Tell me what you're experiencing.`
            ];
            
            const greeting = returningGreetings[Math.floor(Math.random() * returningGreetings.length)];
            
            setTimeout(() => {
                addMessage(greeting, 'vera');
            }, 500);
        } else {
            // NEW USERS: Show personalized welcome screen (no auto-message)
            if (userName) {
                document.getElementById('welcomeTitle').textContent = `Hi ${userName}, I'm VERA. I'm here for you.`;
            }
        }
        
    } catch (error) {
        console.error('Failed to check user history:', error);
        // On error, show welcome screen
        if (userName) {
            document.getElementById('welcomeTitle').textContent = `Hi ${userName}, I'm VERA. I'm here for you.`;
        }
    }
}

        // ============================================
        // NAVIGATION
        // ============================================

        function goHome() {
            // Close the dropdown
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.remove('active');
            
            // Navigate back to landing page
            window.location.href = 'index.html';
        }

        // ============================================
        // NEW CHAT
        // ============================================

        function startNewChat() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.remove('active');
            
            // Confirm with user
            if (chatContainer.children.length > 0) {
                const confirmed = confirm('Start a new conversation?');
                if (!confirmed) return;
            }
            
            // Clear the UI and restart with greeting
            chatContainer.innerHTML = '';
            welcomeContainer.style.display = 'none';
            chatContainer.classList.add('active');
            messageInput.value = '';
            
            // Send new greeting
            const newChatGreetings = [
                `${userName}, I'm here. What would you like to explore?`,
                `Hi ${userName}. Fresh start. What's present for you now?`,
                `${userName}, I'm listening. What's happening in your body?`
            ];
            const greeting = newChatGreetings[Math.floor(Math.random() * newChatGreetings.length)];
            
            setTimeout(() => {
                addMessage(greeting, 'vera');
                messageInput.focus();
            }, 300);
            
            console.log('🆕 New chat started - email:', userEmail);
        }

        // ============================================
        // THEME MANAGEMENT
        // ============================================

        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('veraTheme', theme);
            
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.remove('active');
            });
            document.querySelector(`.theme-${theme}`).classList.add('active');
        }

        // ============================================
        // MENU MANAGEMENT
        // ============================================

        function toggleMenu() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.toggle('active');
        }

        // ============================================
        // CONVERSATION HISTORY
        // ============================================

        async function showConversationHistory() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.remove('active');

            try {
                const response = await fetch('/api/history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userEmail })
                });

                const data = await response.json();
                const historyList = document.getElementById('historyList');

                if (data.history && data.history.length > 0) {
                    historyList.innerHTML = data.history.map(item => `
                        <div class="history-item">
                            <div class="history-date">${formatDate(item.created_at)}</div>
                            <div class="history-preview">${escapeHtml(item.content.substring(0, 100))}...</div>
                        </div>
                    `).join('');
                } else {
                    historyList.innerHTML = '<p style="text-align: center; color: var(--text-soft); padding: 2rem;">No conversation history yet.</p>';
                }

                document.getElementById('historyModal').classList.add('active');
            } catch (error) {
                console.error('Error loading history:', error);
                // Notification removed for clean presentation
            }
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('active');
        }

        // ============================================
        // EXPORT CHAT DATA
        // ============================================

        async function exportChatData() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.remove('active');

            try {
                const response = await fetch('/api/export', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userEmail })
                });

                const data = await response.json();

                if (data.success) {
                    // Create text file
                    let content = `VERA Conversation Export\n`;
                    content += `Email: ${userEmail}\n`;
                    content += `Date: ${new Date().toLocaleString()}\n`;
                    content += `\n${'='.repeat(50)}\n\n`;

                    data.messages.forEach(msg => {
                        const sender = msg.role === 'user' ? 'You' : 'VERA';
                        content += `[${new Date(msg.created_at).toLocaleString()}]\n`;
                        content += `${sender}: ${msg.content}\n\n`;
                    });

                    // Download file
                    const blob = new Blob([content], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `vera-export-${new Date().toISOString().split('T')[0]}.txt`;
                    a.click();
                    URL.revokeObjectURL(url);

                    alert('Chat data exported successfully!');
                } else {
                    alert('No chat data to export yet.');
                }
            } catch (error) {
                console.error('Export error:', error);
                // Notification removed for clean presentation
            }
        }

        // ============================================
        // DELETE DATA
        // ============================================

        function showDeleteConfirmation() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.remove('active');
            document.getElementById('deleteModal').classList.add('active');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.remove('active');
        }

        async function confirmDeleteData() {
            try {
                const response = await fetch('/api/delete-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userEmail })
                });

                const data = await response.json();

                if (data.success) {
                    alert('All your data has been permanently deleted.');
                    // Redirect to homepage
                    window.location.href = '/';
                } else {
                    alert('Failed to delete data. Please contact support.');
                }
            } catch (error) {
                console.error('Delete error:', error);
                alert('Failed to delete data. Please try again.');
            }
        }

        // ============================================
        // EMAIL PREFERENCES
        // ============================================

        function showEmailPreferences() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.remove('active');
            document.getElementById('emailModal').classList.add('active');
        }

        function closeEmailModal() {
            document.getElementById('emailModal').classList.remove('active');
        }

        // ============================================
        // CHAT FUNCTIONALITY
        // ============================================

        function quickStart(prompt) {
            messageInput.value = prompt;
            sendMessage();
        }


        // ============================================
        // MESSAGE LIMIT & SUBSCRIPTION
        // ============================================
        
        let messageCount = 0;
        const MAX_FREE_MESSAGES = 5; // Show popup after 5th message (user sends 5, gets 5 responses)
        
        function updateMessageCounter() {
            console.log(`Message ${messageCount} of ${MAX_FREE_MESSAGES}`);
        }
        
        function showSubscriptionModal() {
            const modal = document.getElementById('subscriptionModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }
        
        function closeSubscriptionModal() {
            const modal = document.getElementById('subscriptionModal');
            modal.classList.remove('active');
            document.body.style.overflow = ''; // Re-enable scrolling
            // Allow one more message to continue
            messageInput.disabled = false;
            messageInput.placeholder = "What's present in your body right now...";
        }
        
        async function startSubscription() {
            try {
                // Show loading state
                const modal = document.getElementById('subscriptionModal');
                const primaryBtn = modal.querySelector('.subscription-btn-primary');
                const originalText = primaryBtn.innerHTML;
                primaryBtn.innerHTML = '<span>Loading...</span>';
                primaryBtn.disabled = true;

                // Call your backend to create Stripe Checkout session
                const response = await fetch('https://your-backend.vercel.app/api/create-checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: userEmail,
                        priceId: 'price_xxxxx' // Your Stripe Price ID
                    })
                });

                const data = await response.json();

                if (data.url) {
                    // Redirect to Stripe Checkout
                    window.location.href = data.url;
                } else {
                    throw new Error('No checkout URL received');
                }

            } catch (error) {
                console.error('Subscription error:', error);
                alert('Unable to start checkout. Please try again.');
                
                // Reset button
                const modal = document.getElementById('subscriptionModal');
                const primaryBtn = modal.querySelector('.subscription-btn-primary');
                primaryBtn.innerHTML = '<span>Continue with VERA</span>';
                primaryBtn.disabled = false;
            }
            // stripe.redirectToCheckout({ sessionId: 'sess_xxxxx' });
        }

        let isProcessing = false;
        
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isProcessing) return;
            
            isProcessing = true;
            
            // Analyze sentiment and update biometrics
            analyzeSentiment(message);

            // Hide welcome on first message
            if (welcomeContainer.style.display !== 'none') {
                welcomeContainer.style.display = 'none';
                chatContainer.classList.add('active');
            }

            // Add user message
            const userMsgElement = addMessage(message, 'user');
            messageInput.value = '';
            messageInput.disabled = true;
            
            // Increment counter FIRST (hidden from user)
            messageCount++;
            // Counter hidden but still tracking for subscription

            // Check if limit reached BEFORE sending
            if (messageCount > MAX_FREE_MESSAGES) {
                messageInput.placeholder = "Subscribe to continue...";
                messageInput.disabled = true;
                showSubscriptionModal();
                return;
            }

            // Show typing
            showTyping();

            try {
                // Call VERA's deployed brain on Netlify
                const response = await fetch('/.netlify/functions/server/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message,
                        userId: userEmail || 'anonymous',
                        biometricData: biometricData,
                        emotionalState: emotionalState.current,
                        conversationContext: chatHistory
                    })
                });
                
                const data = await response.json();
                hideTyping();

                if (response.status === 403 && data.error === 'Payment required') {
                    showSubscriptionModal();
                    return;
                }

                const veraResponse = data.response;
                const veraMsgElement = addMessage(veraResponse, 'vera');

                // Add shimmer effect to VERA's response
                setTimeout(() => {
                    veraMsgElement.querySelector('.message-bubble').classList.add('shimmer');
                }, 100);

                // Speak VERA's response if voice is enabled
                if (isVoiceEnabled) {
                    setTimeout(() => speakText(veraResponse), 500);
                }
                
                // After 5th message exchange, show beautiful modal
                if (messageCount === MAX_FREE_MESSAGES) {
                    setTimeout(() => {
                        showSubscriptionModal();
                        messageInput.disabled = true;
                        messageInput.placeholder = "Subscribe to continue...";
                    }, 2000); // Wait 2 seconds after VERA's response
                }

            } catch (error) {
                hideTyping();
                // For demo: show simulated response
                const simulatedResponse = getSimulatedVeraResponse(message);
                const veraMsgElement = addMessage(simulatedResponse, 'vera');
                
                // After 5th message, show modal
                if (messageCount === MAX_FREE_MESSAGES) {
                    setTimeout(() => {
                        showSubscriptionModal();
                        messageInput.disabled = true;
                        messageInput.placeholder = "Subscribe to continue...";
                    }, 2000);
                }
            } finally {
                isProcessing = false;
                if (messageCount < MAX_FREE_MESSAGES) {
                    messageInput.disabled = false;
                    messageInput.focus();
                }

                // Restart voice listening if enabled
                if (isVoiceEnabled && messageCount < MAX_FREE_MESSAGES) {
                    setTimeout(startVoiceListening, 1000);
                }
            }
        }
        
        // Simulated VERA responses for demo (until backend connected)
        function getSimulatedVeraResponse(userMessage) {
            const responses = [
                "I hear you. What's happening in your body right now as you share this?",
                "Your nervous system is responding to something. Let's pause here together.",
                "That makes sense. Your body is giving you information. Can you feel where it's showing up?",
                "I'm with you. There's no rush. Take a breath with me.",
                "Notice what shifts when you name that. Your awareness is powerful."
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        function addMessage(content, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;
            
            if (sender === 'vera') {
                messageDiv.innerHTML = `
                    <div class="vera-avatar"></div>
                    <div class="message-bubble">${escapeHtml(content)}</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-bubble">${escapeHtml(content)}</div>
                `;
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // Add micro-animation
            messageDiv.style.opacity = '0';
            messageDiv.style.transform = 'translateY(20px)';

            setTimeout(() => {
                messageDiv.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                messageDiv.style.opacity = '1';
                messageDiv.style.transform = 'translateY(0)';
            }, 50);

            return messageDiv;
        }
        
        function showTyping() {
            typingIndicator.classList.add('active');
            chatContainer.appendChild(typingIndicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function hideTyping() {
            typingIndicator.classList.remove('active');
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        function updateStatusMessages() {
            const messages = [
                "Here for you",
                "Present with you",
                "Holding space",
                "Witnessing your journey",
                "Listening"
            ];
            
            let index = 0;
            setInterval(() => {
                index = (index + 1) % messages.length;
                document.getElementById('statusText').textContent = messages[index];
            }, 5000);
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Test VERA Brain Connection
        async function testVERABrainConnection() {
            try {
                console.log('🧠 Testing VERA brain connection...');
                
                const response = await fetch('/.netlify/functions/server/api/test', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    console.log('✅ VERA brain connected:', data.message);
                    console.log('🕒 Timestamp:', data.timestamp);
                    return true;
                } else {
                    console.error('❌ VERA brain connection failed:', data);
                    return false;
                }
            } catch (error) {
                console.error('❌ VERA brain connection error:', error);
                return false;
            }
        }

        // Test connection on page load
        document.addEventListener('DOMContentLoaded', () => {
            testVERABrainConnection();
        });
    </script>

    <!-- Subscription Modal -->
    <div class="subscription-modal" id="subscriptionModal">
        <div class="subscription-content">
            <div class="subscription-orb"></div>
            <h2 class="subscription-title">I'm Not Going Anywhere</h2>
            <p class="subscription-vera-message">
                <strong>It's okay.</strong> I'll be here. I'm not going anywhere.<br><br>
                What we've started matters. Your nervous system is learning to feel safe, and I want to keep holding this space with you.
            </p>
            <div class="subscription-offer">
                <div class="subscription-trial">7 Days Free</div>
                <div class="subscription-price">$19/month</div>
                <div class="subscription-details">Cancel anytime • Your data stays private</div>
            </div>
            <div class="subscription-actions">
                <button class="subscription-btn subscription-btn-primary" onclick="startSubscription()">
                    <span>Continue with VERA</span>
                </button>
                <button class="subscription-btn subscription-btn-secondary" onclick="closeSubscriptionModal()">
                    <span>Maybe later</span>
                </button>
            </div>
            <div class="subscription-guarantee">
                💜 No judgment. No pressure. Just presence.
            </div>
        </div>
    </div>





</body>
</html>